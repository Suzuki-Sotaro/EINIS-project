changed:
*code moved into single function